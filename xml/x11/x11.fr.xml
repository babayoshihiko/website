<?xml version = '1.0' encoding = 'utf-8'?>
<!DOCTYPE document SYSTEM "../finkdoc.dtd">
<document filename="index" lang="fr">
  <title>Utilisation de X11 sous Darwin et Mac OS X</title>
  <shorttitle>Utilisation de X11</shorttitle>
  <cvsid>$Id: x11.fr.xml,v 1.11 2004/05/08 22:05:21 michga Exp $</cvsid>
  <preface>
    <p>
Ce document traite de l'utilisation de X11 / XFree86 / Xtools sur les systèmes Mac OS X et Darwin d'Apple.
Il commence par une introduction et l'historique du développement, puis décrit la situation actuelle et les nombreuses options d'utilisation de X11 avec ou sans Fink.
</p>
  </preface>
  <chapter filename="intro" >
    <title>Introduction</title>
    <shorttitle>Intro</shorttitle>
    <section name="def-x11" >
      <title>Qu'est-ce que X11 ?</title>
      <p>
Le <link url="http://www.x.org/" >système X Window</link> Version 11,
ou X11 en raccourci, est un système d'affichage graphique avec une architecture client-serveur transparente au réseau.
Il permet aux applications de tracer sur l'écran des pixels, des lignes, du texte, des images, etc... X11 comprend aussi des librairies supplémentaires qui permettent aux applications de tracer des éléments d'interfaces utilisateur, c'est-à-dire des boutons, des champs texte, etc...
</p>
      <p>
X11 est, de facto, le système graphique standard du monde Unix.
Il est livré avec Linux, les variantes *BSD et la plupart des variantes Unix commerciales.
Les environnements de bureaux, tels CDE, KDE et GNOME, s'exécutent sous X11.
</p>
    </section>
    <section name="def-macosx" >
      <title>Qu'est-ce que Mac OS X ?</title>
      <p>
        <link url="http://www.apple.com/macosx/" >Mac OS X</link> est un système opératoire conçu par <link url="http://www.apple.com/" >Apple Computer</link>.
Comme ses prédécesseurs NeXTStep et OpenStep, il est basé sur BSD et fait donc partie de la famille des systèmes opératoires Unix.
Néanmoins, il possède un système d'affichage graphique propriétaire.
Le moteur graphique est appelé Quartz et l'interface Aqua, bien que les deux noms soient souvent utilisés de manière interchangeable.
</p>
    </section>
    <section name="def-darwin" >
      <title>Qu'est-ce que Darwin ?</title>
      <p>
        <link url="http://OpenDarwin.org/" >Darwin</link> est, à la base, une version réduite de Mac OS X, disponible gratuitement avec son code source.
Il ne contient ni Quartz, ni Aqua, ni aucune des technologies qui leur sont rattachées.
Par défaut, il ne fournit qu'une console texte.
</p>
    </section>
    <section name="def-xfree86" >
      <title>Qu'est-ce que XFree86 ?</title>
      <p>
        <link url="http://www.xfree86.org/" >XFree86</link> est une implémentation open source de X11.
Au départ, elle a été développée pour tourner sous PC Intel x86, d'où son nom.
De nos jours, elle tourne sur de nombreuses architectures et systèmes opératoires, entre autres OS/2, Darwin, Mac OS X et Windows.
</p>
    </section>
    <section name="def-xtools" >
      <title>Qu'est-ce que Xtools ?</title>
      <p>
Xtools est un produit de  <link url="http://www.tenon.com/" >Tenon Intersystems</link>.
Basée sur XFree86, c'est une version de X11 pour Mac OS X.
</p>
    </section>
    <section name="client-server" >
      <title>Client et Serveur</title>
      <p>
X11 possède une architecture client-serveur.
Un programme central réalise la partie graphique et coordonne l'accès des différentes applications, c'est le serveur.
Une application qui veut exécuter une fonction graphique sous X11 se connecte au serveur et lui indique ce qu'il faut dessiner.
Ces applications sont appelées clients dans le monde X11.
</p>
      <p>
Sous X11, le serveur et les clients peuvent être situés sur des machines différentes, ce qui conduit parfois à une confusion de terminologie.
Dans un environnement constitué de stations de travail et de serveurs, on exécute le serveur d'affichage X11 sur la station de travail et les applications (les clients X) sur la machine serveur.
Ainsi, lorsque l'on parle de &quot;serveur&quot;, on entend par là le serveur d'affichage X11, et non pas la machine caché dans un placard.
</p>
    </section>
    <section name="rootless" >
      <title>Que signifie sans racine (rootless) ?</title>
      <p>
Contexte :
X11 modélise l'écran comme une arborescence de fenêtre contenues les unes dans les autres.
À la racine de l'arborescence se trouve une fenêtre spéciale de la taille de l'écran et qui contient toutes les autres fenêtres.
Cette fenêtre contient le fond du bureau et est appelée la &quot;fenêtre racine&quot;.
</p>
      <p>
Maintenant, revenons à nos moutons :
comme tout environnement graphique, X11 a été écrit pour fonctionner seul et prendre le contrôle de l'écran tout entier.
Sous Mac OS X, Quartz contrôle déjà l'écran, aussi il faut prendre des dispositions pour que les deux environnements puissent fonctionner en même temps.
</p>
      <p>
Une des possibilités est de faire fonctionner les deux environnements à tour de rôle.
À chaque environnement est affecté un écran, mais seul l'un d'entre eux est visible à un moment donné, et l'utilisateur peut basculer de l'un à l'autre.
C'est ce qu'on appelle le mode plein-écran ou mode racine.
Il est appelé ainsi car il y a alors sur l'écran X11 une fenêtre racine parfaitement normale qui fonctionne exactement comme sur les autres systèmes.
</p>
      <p>
L'autre possibilité consiste à mêler les fenêtres des deux environnements.
Cela élimine la nécessité de basculer entre les deux écrans.
Cela élimine aussi la fenêtre racine de X11, car Quartz se charge déjà du fond de bureau.
Comme il n'y aucune fenêtre racine (visible), ce mode est appelé &quot;sans racine&quot;. C'est la façon la plus agréable d'utiliser X11 sous Mac OS X.
</p>
    </section>
    <section name="wm" >
      <title>Qu'est-ce qu'un gestionnaire de fenêtres ?</title>
      <p>
Dans la plupart des environnements graphiques, l'aspect des cadres de fenêtres (barre de titre, bouton de fermeture, etc...) est défini par le système.
Sous X11, il en va autrement.
Dans cet environnement, les cadres de fenêtres (aussi nommés &quot;ornements&quot;) sont fournis par un programme distinct, appelé le gestionnaire de fenêtres.
À bien des égards, le gestionnaire de fenêtres n'est autre qu'une application client ; il est lancé de la même façon et dialogue avec le serveur X au travers des mêmes canaux. 
</p>
      <p>
Vous avez le choix entre une multitude de gestionnaires de fenêtres.
Le site <link url="http://www.xwinman.org/" >xwinman.org</link> en donne la liste complète.
Les plus populaires sont ceux qui permettent à l'utilisateur de personnaliser leur apparence via ce qu'on appelle des <link url="http://www.themes.org/" >thèmes</link>.
La plupart des gestionnaires de fenêtres fournissent d'autres fonctionnalités, comme les menus déroulant dans la fenêtre racine, les docks et les boutons de lancement.
</p>
      <p>
De nombreux gestionnaires de fenêtres ont été compilés pour Fink ; en voici la <link url="http://fink.sourceforge.net/pdb/section.php/x11-wm/" >liste actuelle</link>.
      </p>
    </section>
    <section name="desktop" >
      <title>Que sont Quartz/Aqua, Gnome et KDE ?</title>
      <p>
Ce sont des environnements de bureau, et il y en a bien d'autres. Leur but est de proposer un cadre aux applications, de telle sorte que leur aspect et leur comportement présentent une constante visuelle. Par exemple :
</p>
      <p>un moteur graphique : X11
</p>
      <p>un gestionnaire de fenêtre : <link url="http://sawmill.sourceforge.net/" >sawfish</link>
      </p>
      <p>un bureau  : <link url="http://www.gnome.org/" >Gnome</link>
      </p>
      <p>
La frontière entre moteur d'affichage graphique, gestionnaire de fenêtres et bureau est floue, car une même fonctionnalité (ou une fonctionnalité similaire) peut être implémentée par l'un de ces environnements ou plusieurs d'entre eux. C'est une des raisons pour laquelle un gestionnaire de fenêtres particulier peut ne pas fonctionner avec un environnement de bureau donné.
</p>
      <p>
De nombreuses applications sont développées pour être intégrées dans un environnement de bureau spécifique. 
Très souvent, il suffit d'installer les librairies de l'environnement de bureau (et les librairies sous-jacentes) avec lesquelles l'application a été développée pour qu'elle fonctionne (quasi) sans perte de fonctionnalités.
Par exemple, un nombre de plus en plus grand d'<link url="http://fink.sourceforge.net/pdb/section.php/gnome" >applications GNOME</link> fonctionnent hors de l'environnement GNOME.
Malheureusement, <link url="http://fink.sourceforge.net/faq/usage-fink.php#kde" >ce n'est pas encore le cas</link> pour les <link url="http://www.kde.org/" >applications KDE</link>.
      </p>
    </section>
  </chapter>
  <chapter filename="history" >
    <title>Historique</title>
    <shorttitle>Historique</shorttitle>
    <preface>
      <p>[Désolée pour le langage épique, c'était trop tentant...]</p>
    </preface>
    <section name="early" >
      <title>Genèse</title>
      <p>
Au commencement était le néant.
Darwin balbutiait à peine, Mac OS X en était encore au stade embryonnaire et il n'existait aucune implémentation de X11 pour l'un et l'autre.
</p>
      <p>
Il y eut John Carmack qui porta XFree86 sur Mac OS X Server, le seul système opératoire disponible en ce temps-là dans la famille Darwin.
Puis vint Dave Zarzycki qui modifia ce port pour XFree86 4.0 et Darwin 1.0.
Les rustines trouvèrent un nid douillet dans le référentiel CVS de Darwin et s'y reposèrent en attendant les évènements.
</p>
    </section>
    <section name="xonx-forms" >
      <title>Création de XonX</title>
      <p>
Un beau jour apparut Torrey T. Lyons et il donna aux rustines Darwin tous les soins qu'elles réclamaient.
Enfin, il les plaça dans un nouveau foyer, le référentiel CVS officiel de XFree86.
Ce fut l'ère de Mac OS X Public Beta et de Darwin 1.2.
XFree86 4.0.2 tournait bien sur Darwin, mais les utilisateurs de Mac OS X devait se déconnecter d'Aqua et ouvrir la console pour le faire tourner.
Alors Torrey prit avec lui l'<link url="http://mrcla.com/XonX/" >équipe XonX</link> et commença un long voyage vers le port de XFree86 sur Mac OS X.
</p>
      <p>
À peu près à la même époque, Tenon commença à construire XTools, en se fondant sur XFree86 4.0.
</p>
    </section>
    <section name="root-or-not" >
      <title>Être ou ne pas être racine</title>
      <p>
Bientôt l'équipe XonX réussit à faire tourner XFree86 en mode plein écran parallèlement à Quartz et mit à disposition d'utilisateurs intrépides des versions de test.
Celles-ci furent appelées XFree86-Aqua, ou XAqua en raccourci.
Comme Torrey avait pris l'initiative de tout cela, les modifications allèrent directement dans le référentiel CVS de XFree86, ce qui aboutit à la version 4.1.0.
</p>
      <p>
Dans les premiers temps, l'interface avec Quartz se faisait via une petite application appelée Xmaster.app (écrite avec Carbon, puis réécrite en Cocoa).
Plus tard, ce code fut intégré dans le serveur X, donnant naissance à XDarwin.app.
La gestion des librairies partagées fut ajoutée à cette époque (et l'on réussit à convaincre Tenon d'utiliser ce jeu de rustines au lieu du leur, afin de garantir la compatibilité binaire).
Il y eut même une certaine avancée sur un mode sans racine (avec l'API Carbon), mais hélas, il était trop tard pour l'intégrer dans XFree86 4.10.
Et la rustine sans racine vogua, sans attaches, sur le réseau.
Après la mise à disposition de XFree86 4.10 en mode en plein écran, les travaux sur le mode sans racine continuèrent, en utilisant l'API Cocoa cette fois-ci.
Un mode sans racine expérimental fut mis dans le référentiel CVS de XFree86.
 </p>
      <p>
Pendant ce temps, Apple sortait Mac OS X 10.0 et Darwin 1.3 ; quelques semaines plus tard, Tenon sortait Xtools 1.0.
</p>
      <p>Les travaux d'intégration du mode sans racine dans XFree86 continuèrent, si bien que, lorsque XFree86 4.2.0 sortit en janvier 2002, la version Darwin/Mac OS X avait été complètement intégrée dans la distribution principale de XFree86.
</p>
    </section>
  </chapter>
  <chapter filename="inst-xfree86" >
    <title>Récupération et installation de XFree86</title>
    <shorttitle>Installation de XFree86</shorttitle>
    <section name="fink" >
      <title>Installation via Fink</title>
      <p>
Fink vous permet d'installer X11 comme vous voulez, mais il fournit aussi ses propres paquets XFree86. Si vous utilisez, <code>fink install ...</code>, il téléchargera le code source et le compilera sur votre ordinateur. Si vous utilisez <code>apt-get install ...</code> ou l'interface <code>dselect</code>, il téléchargera des paquets binaires précompilés, identiques à ceux de la distribution officielle XFree86.
</p>
      <p>
Le paquet <code>xfree86-base</code> contient l'ensemble de XFree86 4.2.1.1 (4.2.0 pour les utilisateurs de 10.1), sauf le serveur XDarwin.  
Le paquet <code>xfree86-rootless</code> est le serveur de la version standard, stable de  XFree86 4.2.1.1. Il gère à la fois les modes plein écran et racine, ainsi qu'OpenGL.
(Au début, Fink avait aussi un paquet <code>xfree86-server</code> qui ne fournissait que le mode plein écran, mais ce n'est plus nécessaire.)
Vous pouvez aussi installer le serveur vous-même ; voir plus bas. Dans ce cas, vous devez installer <code>xfree86-base</code>, sinon Fink viendra écraser le serveur installé précédemment. Notez que la version stable actuelle de <code> xfree86-base</code> (4.2.1.1-3) génère <code>xfree86-rootless</code>, <code>xfree86-base-shlibs</code> et <code>xfree86-rootless-shlibs</code> pendant la compilation. Dans ce cas, les quatre paquets doivent être installés pour avoir une configuration valide de XFree86.
</p>
      <p>Les paquets <code> xfree86-base-threaded</code> et <code>xfree86-rootless-threaded</code> sont similaires aux précédents, mais ont été modifiés pour gérer les processus légers, nécessaires à un petit nombre d'applications, tel <filename>xine</filename>.</p>
      <p>XFree86 4.2.11 (sans gestion des processus légers) est considérée comme la version de base stable de XFree86 à utiliser avec Fink sur 10.2. XFree86 4.3.0 est disponible, mais elle est plus expérimentale, et n'était disponible que dans la branche instable à l'époque où ce document a été écrit. Elle gère nativement les processus légers et est plus rapide que la version 4.2.1.1.  Pour installer cette version, vous devez installer le paquet <code>xfree86</code>. Notez que, dans cette version, il n'y a plus de séparation entre paquet -base et paquet -rootless, bien que les librairies soient regroupées dans un paquet <code>xfree86-shlibs</code>. Si vous compilez des binaires avec la version 4.3, ils peuvent ne pas fonctionner sur 4.2.1.1 ou Apple X11, tenez-en compte.</p>
      <p>
        <em>Utilisateurs 10.3 :</em> Vous devez installer la version 4.3.99.16-2 ou ultérieure, qui sont des pré-versions de XFree86-4.4. Si vous travaillez à partir de la distribution binaire, assurez-vous que vous mettez à jour les descriptions de paquets (par exemple via <code>sudo apt-get update</code>).</p>
    </section>
    <section name="apple-binary" >
      <title>Binaires d'Apple</title>
      <p>
Le 7 janvier 2003, Apple a mis à disposition <link url="http://www.apple.com/macosx/x11/" >une implémentation X11 personnalisée et basée sur XFree86-4.2</link>, qui incluait un rendu Quartz et l'accélération OpenGL. Une nouvelle version est sortie le 10 Février 2003, qui comportait des fonctionnalités supplémentaires et des corrections de bogues. Une troisième version (la Bêta 3) est sortie le 17 mars 2003 avec de nouvelles fonctionnalités et des corrections de bogues. Cette version peut être utilisée sur Jaguar.
</p>
      <p>Le 24 octobre 2003, Apple a sorti Panther (10.3), qui inclut sa propre version de X11. Cette version est basée sur XFree86-4.3.</p>
      <p>
Pour utiliser les binaires d'Apple, vous devez d'une part vous assurer que le paquet <em>X11 User</em> est installé et, d'autre part <link url="http://fink.sourceforge.net/doc/users-guide/upgrade.php" >mettre à jour</link> Fink.</p>
      <p>Avec <code>fink-0.16.2</code>, vous devez aussi installer le paquet <em>X11 SDK</em>. Ensuite, Fink créera un paquet virtuel <code>system-xfree86</code>.
      </p>
      <p>Avec <code>fink-0.17.0</code> et les versions ultérieures, n'installez le paquet X11 SDK que si vous souhaitez construire des paquets à partir du source. Dans ce cas, même si vous n'avez pas installé le SDK, il y aura création des paquets virtuels <code>system-xfree86</code> et <code>system-xfree86-shlibs</code>, ce dernier correspondant aux librairies partagées. Si vous installez le SDK, il y aura création d'un paquet <code>system-xfree86-dev</code>, représentant les headers.
</p>
      <p>
Si vous avez déjà installé une distribution XFree86, que ce soit avec Fink ou non, vous pouvez suivez les  <xref section="switching-x11" chapter="inst-xfree86" >instructions de remplacement d'un paquet X11 par un autre</xref>. Supprimez vos paquets existants, puis installez X11 d'Apple (et, éventuellement, X11 SDK).
</p>
      <p>
Notes au sujet de l'utilisation de X11 d'Apple :
</p>
      <ul>
        <li>
          <p>Le paquet <filename>autocutsel</filename> n'est plus nécessaire. Vous devez le désactiver avant de démarrer X11 d'Apple, dans le cas où il serait activé.</p>
        </li>
        <li>
          <p>X11 d'Apple utilise votre fichier de configuration <filename>~/.xinitrc</filename>, s'il existe. Si vous voulez profiter au maximum de l'intégration Quartz, utilisez <filename>/usr/X11R6/bin/quartz-wm</filename> comme gestionnaire de fenêtres, ou supprimez complètement votre fichier <filename>~/.xinitrc</filename>.</p>
          <p>Si vous voulez simplement pouvoir copier-coller, mais désirez utiliser un autre gestionnaire de fenêtres, vous pouvez vous baser sur l'exemple suivant :</p>
          <codeblock>/usr/X11R6/bin/quartz-wm --only-proxy &amp;
exec /sw/bin/fvwm2</codeblock>
          <p>Vous pouvez, bien entendu, utiliser un autre gestionnaire de fenêtres, <code>startkde</code>, etc...</p>
        </li>
        <li>
          <p>
            <filename>quartz-wm</filename> ne gère pas complètement les astuces des gestionnaires de fenêtres Gnome/KDE. Vous observerez peut-être des comportements étranges dans des fenêtres qui ne devraient pas avoir d'ornements, mais en ont pourtant.</p>
        </li>
        <li>
          <p>X11 d'Apple ne respecte pas, par défaut, les configurations d'environnement de Fink. Pour démarrer des applications installées via Fink (par exemple : gestionnaires de fenêtres,  gnome-session ou d'autres applications situées dans le répertoire <filename>/sw/bin</filename>), placez la ligne suivante dans les premières lignes du fichier <filename>~/.xinitrc</filename> (c'est-à-dire après l'initialisation &quot;<filename>#!/bin/sh</filename>&quot;, mais avant de démarrer tout autre programme) :</p>
          <codeblock> . /sw/bin/init.sh
</codeblock>
          <p>de façon à ce que votre environnement Fink soit initialisé. Note : <filename>init.sh</filename> est utilisé au lieu de <filename>init.csh</filename>, car <filename>.xinitrc</filename> est lancé par <filename>sh</filename> au lieu de <filename>tcsh</filename>.</p>
        </li>
        <li>
          <p>Les applications qui appellent d'autres programmes situés dans l'arborescence de Fink pour réaliser certaines de leurs fonctions doivent subir un traitement spécial pour que l'on puisse les appeler à partir du menu Applications. Au lieu de mettre le chemin complet du fichier, par exemple :</p>
          <codeblock>/sw/bin/emacs</codeblock>
          <p>vous devez utiliser une commande semblable à la suivante, si vous utilisez le shell bash :</p>
          <codeblock>. /sw/bin/init.sh ; emacs</codeblock>
          <p>et si vous utilisez le shell tcsh, une commande semblable à celle-ci :</p>
          <codeblock>source /sw/bin/init.csh ; emacs</codeblock>
          <p>Ceci garantit que l'application aura un PATH correct. Vous pouvez utiliser cette syntaxe pour toute application installée via Fink.</p>
        </li>
        <li>
          <p>Si vous tentez de compiler un paquet avec X11 d'Apple et que vous obtenez une erreur du genre suivant :</p>
          <codeblock>ld: err.o illegal reference to symbol: _XSetIOErrorHandler 
defined in indirectly referenced dynamic library 
/usr/X11R6/lib/libX11.6.dylib</codeblock>
          <p>assurez-vous alors que le drapeau <code>-lX11</code> existe à l'édition de liens. Vérifiez les options de compilation de votre paquet pour voir comment fournir ce paramètre.</p>
        </li>
        <li>
          <p>Si vous utilisez le paquet <code>xfree86</code> et que vous changiez plus tard pour X11 d'Apple (sur 10.2.x ou 10.3.x), vous devez recompiler tout paquet compilé antérieurement avec <code>xfree86</code>, car les binaires sont incompatibles.</p>
        </li>
      </ul>
    </section>
    <section name="official-binary" >
      <title>Binaires officiels</title>
      <p>Le projet XFree86 comprend une distribution binaire officielle de XFree86 4.2.0, qui peut être mise au niveau 4.2.1.1 à l'aide de rustines. Vous la trouverez sur votre <link url="http://www.xfree86.org/MIRRORS.shtml" >miroir XFree86</link> local dans le répertoire <code>4.2.0/binaries/Darwin-ppc-5.x</code>. Téléchargez les fichiers archives tar <filename>Xprog.tgz</filename> et <filename>Xquartz.tgz</filename> bien qu'ils soient mentionnés comme optionnels. Si vous ne savez pas quels fichiers sont nécessaires, téléchargez tout le répertoire. Lancez le script <filename>Xinstall.sh</filename> en tant que super-utilisateur pour installer l'ensemble. (Nous vous conseillons de lire les <link url="http://www.xfree86.org/4.2.0/Install.html" >instructions officielles</link> avant l'installation). Vous pouvez aussi, si vous le souhaitez, utiliser le <link url=" http://prdownloads.sourceforge.net/xonx/XInstall_10.1.sit?download" >binaire</link> de XonX, qui a un source identique mais est plus facile à utiliser. Dans les deux cas, téléchargez, décompressez et lancez les mises à niveau suivantes :</p>
      <ol>
        <li>Utilisateurs 10.1 : <link url="http://prdownloads.sourceforge.net/xonx/XFree86_4.2.0.1-10.1.zip?download" >mise à niveau 4.2.0 -> 4.2.0.1</link>.  Utilisateurs 10.2:  <link url="http://prdownloads.sourceforge.net/xonx/XFree86_4.2.0.1-10.2.zip?download" >mise à niveau 4.2.0 -> 4.2.0.1</link>
        </li>
        <li>Utilisateurs 10.1 et 10.2 :  <link url="http://prdownloads.sourceforge.net/xonx/XFree86_4.2.1.1.zip?download" >mise à niveau 4.2.0.1 -> 4.2.1.1</link>
        </li>
      </ol>
      <p>Il existe aussi une distribution binaire officielle de XFree86 4.3.0 sur les <link url="http://www.xfree86.org/MIRRORS.shtml" >miroirs XFree86</link> dans le répertoire <code>4.3.0/binaries/Darwin-ppc-6.x</code>. Téléchargez les fichiers archives tar <filename>Xprog.tgz</filename> et <filename>Xquartz.tgz</filename> bien qu'ils soient mentionnés comme optionnels. Si vous ne savez pas quels fichiers sont nécessaires, téléchargez tout le répertoire. Lancez le script <filename>Xinstall.sh</filename> en tant que super-utilisateur pour installer l'ensemble. (Nous vous conseillons de lire les <link url="http://www.xfree86.org/4.3.0/Install.html" >instructions officielles</link> avant l'installation.)</p>
      <p>Quelle que soit la version que vous avez installée, vous aurez alors XFree86 avec un serveur plein écran ou sans racine sous Mac OS X.</p>
    </section>
    <section name="official-source" >
      <title>Source Officiel</title>
      <p>Si vous avez du temps à perdre, vous pouvez compiler XFree86 4.2.0 à partir du source.
      Vous trouverez le source sur un des miroirs cités sur <link url="http://www.xfree86.org/MIRRORS.shtml" >XFree86 mirror</link> dans le répertoire <code>4.2.0/source</code>.
Téléchargez les trois archives tar <filename>X420src-#.tgz</filename> et décompressez-les dans un même répertoire.
Vous pouvez adapter la compilation à vos besoins en plaçant des définitions de macros dans le fichier <filename>config/cf/host.def</filename> situé dans l'arborescence source de XFree86.
<!--
To build on pure Darwin, create the file
<code>config/cf/host.def</code> in the XFree86 source tree and put the
following line in it:
</p>
<codeblock>#define DarwinQuartzSupport NO</codeblock>
<p>
You can add further defines to that file if you want; see
-->
Voir le fichier <filename>config/cf/darwin.cf</filename> pour quelques explications.
(Note : Seules les macros insérées dans un #ifndef peuvent être modifiées dans host.def.)
</p>
      <p>
Quand vous aurez fini la configuration, compilez et installez XFree86 à l'aide des commandes suivantes :
</p>
      <codeblock>make World
sudo make install install.man</codeblock>
      <p>Pour passer en version 4.2.1.1, suivez les instructions de la section <xref section="official-binary" >Binaires officiels</xref>.</p>
      <p>Pour installer la version 4.3.0, suivez les instructions ci-dessus en remplaçant &quot;2&quot; par &quot;3&quot;, et n'utilisez surtout pas la procédure de mise à jour 4.2.1.1.</p>
      <p>
Tout comme avec les binaires officiels, vous obtiendrez XFree86 avec un serveur en mode plein écran ou sans racine sous Mac OS X.
</p>
    </section>
    <section name="latest-cvs" >
      <title>Source le plus récent</title>
      <p>
Si vous avez le temps et des nerfs à toute épreuve, vous pouvez utiliser la dernière version de développement de XFree86 via le référentiel public CVS.
Notez que le code est mis à jour constamment ; d'un jour à l'autre il est modifié.
</p>
      <p>
Afin de l'installer, suivez les instructions sur <link url="http://www.xfree86.org/cvs/" >XFree86 CVS</link> pour télécharger le module <filename>xc</filename>.
Puis suivez les instructions de compilation du source ci-dessus.
</p>
    </section>
<!--><section name="xonx-bin" >
<title>The XonX binary test releases (XAqua,
XDarwin)</title>
<p>
In the time before 4.1.0 was released, the XonX team put out a series
of binary test releases with the name XAqua.
These releases are obsolete and should not be used.
</p>
<p>
With the introduction of rootless mode into XFree86's mainline CVS
(after 4.1.0 was released), the XonX team once again started to
put out binary test releases, this time under the name XDarwin.
This eventually resulted in the XDarwin released with 4.2.0.
</p>
<p>The <link url="http://www.mrcla.com/XonX/" >XonX
web page</link> indicates that post-4.2.0 testing versions of XDarwin may
someday be released, but none have been as yet.  They would presumably be 
installed on top of XFree86 4.2.0 (or later).
</p>
</section><-->    <section name="macgimp" >
      <title>MacGimp</title>
      <p>
L'installeur téléchargeable qui fut proposé par l'équipe MacGimp en 2001 ne contenait pas XFree86. (Il écrasait, malgré tout, certains fichiers de configuration de XFree86.)
</p>
      <p>
Le CD vendu par <link url="http://www.macgimp.com/" >MacGimp, Inc.</link> contient une version de XFree86. Toutefois, il est impossible de déterminer laquelle ; c'est probablement un mélange des versions 4.0.3, 4.1.0 et d'une version de développement. Le serveur fonctionne en mode sans racine, à partir d'une rustine datant d'avant la version 4.1.0.
</p>
    </section>
<!--><section name="rootless" >
<title>Roaming Rootless Servers</title>
<p>
There are various rootless server binaries roaming around
the net.  With the release of the official 4.2.0 binaries
this should not be a desirable way to install XFree86.
</p>
</section><-->    <section name="switching-x11" >
      <title>Remplacement de X11</title>
      <p>
Si vous avez installé l'un des paquets X11 de Fink, mais que, pour une raison ou une autre, vous décidez de le supprimer pour le remplacer par un autre, la procédure à suivre est simple. Vous devez forcer la suppression des anciens paquets, puis installer les nouveaux de façon à préserver la cohérence de la base de données dpkg.
</p>
      <p>
Il y a deux façons de le faire :
</p>
      <ol>
        <li>
          <p>Via FinkCommander</p>
          <p>
Si vous utilisez  <link url="http://finkcommander.sourceforge.net/" >FinkCommander</link>, vous pouvez forcer la suppression via le menu. Par exemple, si vous avez installé <filename>xfree86-rootless</filename> et que vous vouliez installer la version gérant les processus légers, sélectionnez les paquets <filename>xfree86-rootless</filename>, <filename>xfree86-rootless-shlibs</filename>, <filename>xfree86-base</filename> et <filename>xfree86-base-shlibs</filename>, puis lancez :
  </p>
          <codeblock>Source -> Force Remove</codeblock>
        </li>
        <li>
          <p>Manuellement via la ligne de commande</p>
          <p>
Pour faire une suppression manuelle, utilisez <filename>dpkg</filename> avec l'option --force-depends :
  </p>
          <codeblock>sudo dpkg -r --force-depends xfree86-rootless\ 
xfree86-rootless-shlibs xfree86-base xfree86-base-shlibs</codeblock>
          <p>
Notez que si vous utilisez des applications qui nécessitent la version de XFree86 qui gère les processus légers, vous risquez d'avoir quelques problèmes avec la base de données dpkg, si vous supprimez de force cette version et installez un autre paquet XFree86 ou un paquet fantôme le représentant.
  </p>
        </li>
      </ol>
      <p>Si vous utilisez une version de X11 qui n'a pas été installé via Fink, vous devez la supprimer via la ligne de commande :</p>
      <codeblock>sudo rm -rf /usr/X11R6 /etc/X11</codeblock>
      <p>Ceci est vrai pour tout paquet X11 non installé via Fink. Vous devez aussi supprimer <filename>XDarwin.app</filename> ou <code>X11.app</code>, suivant l'installation effectuée. Examinez le fichier <filename>.xinitrc</filename> quand vous supprimez X11 d'Apple pour vous assurer qu'il ne lance pas <filename>quartz-wm</filename>.  Vous pouvez ensuite installer la nouvelle variante X11 désirée, manuellement ou via Fink.</p>
    </section>
    <section name="fink-summary" >
      <title>Résumé des paquets Fink disponibles</title>
      <p>
Voici un court résumé des options d'installation et des paquets Fink à installer :
</p>
      <itemtable labelt="Type d'installation" labeld="Paquets Fink" >
        <item>
          <itemt>4.2.x compilé via Fink</itemt>
          <itemd>
            <p>
              <code>xfree86-base</code> et <code>xfree86-rootless</code> (et les paquets <code>-shlibs</code> associés)</p>
            <p>ou <code>xfree86-base-threaded</code> et <code>xfree86-rootless-threaded</code> (et les paquets <code>-shlibs</code> associés)</p>
          </itemd>
        </item>
        <item>
          <itemt>4.3.x compilé via Fink</itemt>
          <itemd>
            <p>
              <code>xfree86</code> et <code>xfree86-shlibs</code>
            </p>
          </itemd>
        </item>
        <item>
          <itemt>Binaires officiels 4.x </itemt>
          <itemd>
            <p>
              <code>system-xfree86</code> seulement (+ paquets associés)</p>
          </itemd>
        </item>
        <item>
          <itemt>4.x compilé à partir du source ou de la dernière version CVS</itemt>
          <itemd>
            <p>
              <code>system-xfree86</code> seulement (+ paquets associés)</p>
          </itemd>
        </item>
<!--obsolete><item>
<itemt>4.2.x base system built via Fink + binary rootless server</itemt>
<itemd>
<p>
<code>xfree86-base</code> only</p>
</itemd>
</item><-->        <item>
          <itemt>4.2.x d'Apple</itemt>
          <itemd>
            <p>
              <code>system-xfree86</code> seulement (+ paquets associés)
</p>
          </itemd>
        </item>
        <item>
          <itemt>4.3.x d'Apple</itemt>
          <itemd>
            <p>
              <code>system-xfree86</code> seulement (+ paquets associés)
</p>
          </itemd>
        </item>
      </itemtable>
    </section>
  </chapter>
  <chapter filename="run-xfree86" >
    <title>Lancement de XFree86</title>
    <shorttitle>Lancement de XFree86</shorttitle>
    <section name="darwin" >
      <title>Darwin</title>
      <p>
Sous Darwin, XFree86 se comporte comme sur n'importe quel autre système Unix. En général, on le lance à partir de la console avec la commande <code>startx</code> ; elle lance le serveur et un certain nombre de clients, tels le gestionnaire de fenêtres et un émulateur de terminal avec shell.
Sous Darwin, il n'est pas nécessaire de fournir des paramètres, on peut simplement utiliser :
</p>
      <codeblock>startx</codeblock>
      <p>
Vous pouvez personnaliser le lancement en utilisant différents fichiers placés dans votre répertoire utilisateur.
<filename>.xinitrc</filename> gère les clients à lancer.
<filename>.xserverrc</filename> gère les options du serveur et peut aussi lancer un autre serveur.
Si vous n'arrivez pas à démarrer correctement (vous obtenez un écran blanc ou XFree86 s'arrête immédiatement), vous pouvez commencer par déplacer ces fichiers ailleurs, pour tenter de résoudre le problème.
Quand <code>startx</code> ne trouve pas ces fichiers, il utilise des paramètres par défaut qui devraient convenir.
</p>
      <p>
Vous pouvez aussi démarrer le serveur directement avec l'une des options XDMCP, comme ceci :
</p>
      <codeblock>X -query remotehost</codeblock>
      <p>
Vous trouverez de plus amples informations dans la man page <code>Xserver</code>.
</p>
      <p>
Enfin, il existe une option pour paramétrer <code>xdm</code> ; voir la man page pour de plus amples informations.
</p>
      <p>
Note : si vous utilisez Mac OS X antérieur à Panther, vous pouvez saisir <code>>console</code> dans la fenêtre d'ouverture de session. Vous accéderez ainsi à une console texte équivalente à Darwin.
Si aucun champ pour saisir un nom d'utilisateur n'apparaît dans la fenêtre d'ouverture de session, tapez simplement la première lettre du nom d'un utilisateur quelconque, puis appuyez simultanément sur alt-retour chariot.
Vous pourrez alors utiliser n'importe quelle méthode de démarrage ci-dessus, à l'exception de <code>xdm</code>.
</p>
<p>
Note : il est impossible de démarrer XFree86 à partir de la console sous Mac OS X Panther.
</p>
    </section>
    <section name="macosx-41" >
      <title>Mac OS X + XFree86 4.x.y</title>
      <p>
Il y a deux façons de lancer XFree86 sous Mac OS X.
L'une est de double-cliquer sur l'application XDarwin.app, située dans le répertoire Applications. Vous pouvez alors choisir entre le mode plein écran et le mode sans racine dans la fenêtre de dialogue qui apparaît à l'écran au lancement. Vous pouvez désactiver cette fenêtre de dialogue et indiquer le mode de démarrage automatique souhaité dans les préférences de XDarwin.  
</p>
      <p>
Avant la version 4.2.0, XDarwin démarrait automatiquement en mode plein écran, et il n'y avait aucun moyen de le faire démarrer en mode sans racine en double-cliquant sur l'application.
</p>
      <p>
La seconde façon de démarrer XFree86 sous Mac OS X est de lancer la commande 
<code>startx</code> dans Terminal.app.
Si vous démarrez le serveur de cette façon, vous devez lui indiquer qu'il fonctionnera en parallèle avec Quartz.
Ce qui se fait en utilisant l'option <code>-fullscreen</code> :
</p>
      <codeblock>startx -- -fullscreen</codeblock>
      <p>
Le serveur démarre alors en mode plein écran, et les clients mentionnés dans le fichier <filename>.xinitrc</filename> sont lancés.  
</p>
      <p>
NOTE : antérieurement à la version 4.2, on utilisait l'option <code>-quartz</code> pour démarrer en mode plein écran.
</p>
      <p>
Si le serveur gère le mode sans racine, vous pouvez le lancer dans ce mode avec l'option <code>-rootless</code> :</p>
      <codeblock>startx -- -rootless</codeblock>
      <p>
L'option <code>-quartz</code> ne sert plus à passer en mode plein écran, mais à utiliser le mode défini dans les préférences.
</p>
      <p>À partir de la version 4.3, la fenêtre de dialogue de démarrage apparaît quand on utilise <code>startx</code> sans paramètres.</p>
    </section>
    <section name="xinitrc" >
      <title>Fichier .xinitrc</title>
      <p>
S'il existe dans votre répertoire utilisateur un fichier nommé <filename>.xinitrc</filename>, il sera utilisé pour lancer quelques clients X au démarrage, tels le gestionnaire de fenêtre, quelques xterm ou un environnement de bureau comme GNOME.
 Le fichier <filename>.xinitrc</filename> est un script shell qui contient les commandes pour ce faire.
 Il <em>n'est pas</em> nécessaire de mettre le traditionnel <code>#!/bin/sh</code> dans la première ligne du fichier et de rendre exécutable le fichier ; xinit sait le lancer via un shell.
</p>
      <p>
S'il n'existe pas de fichier <filename>.xinitrc</filename> dans votre répertoire utilisateur, XFree86 utilise le fichier par défaut <filename>/private/etc/X11/xinit/xinitrc</filename>.
Vous pouvez vous servir de ce fichier comme base pour votre propre fichier .xinitrc :
</p>
      <codeblock>cp /private/etc/X11/xinit/xinitrc ~/.xinitrc</codeblock>
      <p>
Si vous utilisez Fink, vous devez sourcer <filename>init.sh</filename> (si vous utilisez le shell bash) ou <filename>init.csh</filename> (si vous utilisez le shell tcsh) en début de fichier pour garantir une définition corrrecte de votre environnement.
</p>
      <p>
Vous pouvez mettre à peu près n'importe quelle commande dans un fichier <filename>.xinitrc</filename>, mais il faut tenir compte des éléments suivants.
Tout d'abord, le shell qui interprète le fichier attend, par défaut, que chaque programme lancé soit terminé avant de lancer le suivant.
Si vous voulez lancer plusieurs programmes en parallèle, vous devez indiquer au shell qu'il doit les faire tourner en &quot;arrière-plan&quot;, en ajoutant un <code>&amp;</code> à la fin de la ligne.
</p>
      <p>
Ensuite, <code>xinit</code> attend que le script <filename>.xinitrc</filename>
se termine et interprète sa fin ainsi : &quot;la session est terminée, je dois aussi tuer le serveur X maintenant&quot;.
Cela signifie que la dernière commande du fichier <filename>.xinitrc</filename> ne doit pas tourner en arrière-plan et que cette commande doit être un programme de longue durée.
En général, on utilise le gestionnaire de gestionnaire comme dernière commande.
En fait, la plupart des gestionnaires de fenêtres partent du principe que <code>xinit</code> attend qu'ils se terminent et utilisent cela pour faire fonctionner l'article de menu  &quot;Fin de session&quot;.
(Note : Pour restreindre l'usage de la mémoire et le nombre de cycles CPU, vous pouvez mettre un <code>exec</code> au début de la dernière ligne comme dans les exemples ci-dessous.)
</p>
      <p>
 Exemple de démarrage de GNOME :
</p>
      <codeblock>. /sw/bin/init.sh
exec gnome-session</codeblock>
      <p>pour les utilisateurs de bash et :</p>
       <codeblock>source /sw/bin/init.csh
exec gnome-session</codeblock>
<p>pour les utilisateurs de tcsh.</p>
<p>Exemple plus complexe pour les utilisateurs de bash qui suppriment les alertes X11, lance un certain nombre de clients et le gestionnaire de fenêtres Enlightenment :</p>
      <codeblock>. /sw/bin/init.sh

xset b off

xclock -geometry -0+0 &amp;
xterm &amp;
xterm &amp;

exec enlightenment</codeblock>
<p>Les utilisateurs de tcsh doivent changer la première ligne de la manière suivante :</p>
      <codeblock>source /sw/bin/init.csh</codeblock>
 <p>Pour démarrer GNOME 2.2 sous X11 d'Apple, utilisez les commandes suivantes :</p>    
 <codeblock>. /sw/bin/init.sh
quartz-wm --only-proxy &amp;
metacity &amp;
exec gnome-session
</codeblock> 
<p>Note : même changement sur la première ligne pour les utilisateurs de tcshs que celle indiquée ci-dessus.</p>
<p>Pour GNOME 2.4 sous X11 d'Apple, metacity est lancée automatiquement, les commandes sont donc réduiteq à :</p>    
 <codeblock>. /sw/bin/init.sh
quartz-wm --only-proxy &amp;
exec gnome-session
</codeblock> 
<p>Note : même changement sur la première ligne pour les utilisateurs de tcshs que celle indiquée ci-dessus.</p>
<p>Pour lancer KDE 3.2 (version &lt; 3.2.2-21) sous X11 d'Apple :</p>
<codeblock>. /sw/bin/init.sh
export KDEWM=kwin
quartz-wm --only-proxy &amp;
/sw/bin/startkde >/tmp/kde.log 2>&amp;1
</codeblock>
<p>Note : même changement sur la première ligne pour les utilisateurs de tcshs que celle indiquée ci-dessus.</p>
<p>Et enfin pour lancer la toute dernière version de KDE sous X11 d'Apple :</p>
<codeblock>. /sw/bin/init.sh
/sw/bin/startkde >/tmp/kde.log 2>&amp;1
</codeblock>
    </section>
  </chapter>
  <chapter filename="xtools" >
    <title>Xtools</title>
    <shorttitle>Xtools</shorttitle>
    <section name="install" >
      <title>Installation de Xtools</title>
      <p>
Pour une fois, c'est facile. Récupérez l'installeur, double-cliquez dessus et suivez les instructions à l'écran. Veillez à choisir le volume de démarrage lorsqu'on vous le demandera.
</p>
      <p>
Si vous utilisez Fink, vous devez installer le paquet <code>system-xtools</code> après avoir installé Xtools. Ce paquet n'installe aucun fichier, il s'assure simplement que les librairies et autres fichiers nécessaires sont présents sur votre système et tient lieu de paquet fantôme dans le système de dépendances de Fink.
</p>
    </section>
    <section name="run" >
      <title>Lancement de Xtools</title>
      <p>
Pour lancer Xtools, double-cliquez sur Xtools.app dans le répertoire Applications. Tout comme XFree86, Xtools lance les clients spécifiés dans le fichier <filename>.xinitrc</filename>. De plus, Xtools vous permet de lancer des clients via son menu.
</p>
    </section>
    <section name="opengl" >
      <title>Notes sur OpenGL</title>
      <p>
Xtools utilise l'accelération matériel OpenGL en mode sans racine et fournit les librairies pour gérer cette fonctionnalité. La librairie principale libGL est parfaite, mais les librairies libGLU et libglut n'existent que sous forme statique, ce qui n'est pas suffisant pour assurer une compatibilité binaire complète avec XFree86. Quelques headers manquent. Fink ne propose pas de solution à ce problème pour le moment. Nous espérons que le problème sera résolu dans Xtools 1.1.
</p>
    </section>
  </chapter>
  <chapter filename="other" >
    <title>Other X11 Possibilities</title>
    <shorttitle>Other Stuff</shorttitle>
    <section name="vnc" >
      <title>VNC</title>
      <p>
VNC is a network-capable graphics display system similar in design to
X11.
However, it works at a lower level, making implementation easier.
With the Xvnc server and a Mac OS X display client, it is possible to
run X11 applications with Mac OS X.
Jeff Whitaker's <link url="http://www.cdc.noaa.gov/~jsw/macosx_xvnc/" >Xvnc page</link> has
more information on that.
</p>
    </section>
    <section name="wiredx" >
      <title>WiredX</title>
      <p>
        <link url="http://www.jcraft.com/wiredx/" >WiredX</link> is an X11
server written in Java.
It also supports rootless mode.
An Installer.app package is available at the web site.
</p>
    </section>
    <section name="exodus" >
      <title>eXodus</title>
      <p>
According to the website, <link url="http://www.powerlan-usa.com/exodus/" >eXodus 8</link> by Powerlan
USA runs natively on Mac OS X.
It is unknown what codebase it uses and whether/how it supports local
clients.
Because of this, there is no special support for eXodus in Fink.
If you have more info, please throw it our way.
</p>
    </section>
  </chapter>
  <chapter filename="trouble" >
    <title>Troubleshooting XFree86</title>
    <shorttitle>Troubleshooting</shorttitle>
    <section name="immedate-quit" >
      <title>When I launch XDarwin, it quits
or crashes almost immediately</title>
      <p>
First of all: Don't Panic!
There are lots of things than can go wrong with XFree86, and a good
number of them can cause startup failures.
Further, it is not unusual that XDarwin crashes when it experiences
startup problems.
This section tries to provide a comprehensive list of problems you may
come across.
But first, you need to gather two important pieces of information:
</p>
      <p>
        <em>XDarwin version.</em>
You can find the XDarwin version in the Finder by clicking
<em>once</em> on the XDarwin icon and then selecting &quot;Show Info&quot;
from the menu.
The version is only incremented when a new binary test release is made
by the XonX project, so &quot;1.0a1&quot; may actually be any version between
1.0a1 and 1.0a2.
</p>
      <p>
        <em>Error messages.</em>
These are essential in pinpointing the particular problem you
experience.
How you get the error messages depends on how you started XDarwin.
If you ran <code>startx</code> from a Terminal window, you'll have the
messages right there in that window.
Remember that you can scroll up.
If you started XDarwin by double-clicking the icon, the messages end
up in the system log, which you can access through the Console
application in the Utilities folder.
Be sure to pick the right set of messages, i.e. the last one.
</p>
      <p>
We'll start with a list of the messages you may see:
</p>
      <codeblock>_XSERVTransmkdir: Owner of /tmp/.X11-unix should be set to root</codeblock>
      <codeblock>_IceTransmkdir: Owner of /tmp/.ICE-unix should be set to root</codeblock>
      <p>
Class: Harmless.
X11 creates hidden directories in /tmp to store the socket &quot;files&quot; for
local connections.
For security reasons, X11 prefers if these directories are owned by
root, but since they are world-writable anyway it will still run
without any problems.
(Note: It's quite hard to have these dirs owned by root, as Mac OS X
wipes out /tmp on reboots and XDarwin doesn't run with root privileges
and doesn't need to.)
</p>
      <codeblock>QuartzAudioInit: AddIOProc returned 1852797029</codeblock>
      <codeblock>-[NSCFArray objectAtIndex:]: index (2) beyond bounds (2)</codeblock>
      <codeblock>kCGErrorIllegalArgument : CGSGetDisplayBounds (display 35434400)</codeblock>
      <codeblock>No core keyboard</codeblock>
      <p>
Class: Bogus.
These are follow-up errors that result when the server tries to reset
itself after a previous error.
During that, another copy of the startup banner is printed, followed
by one or more of the above messages because resetting the server
doesn't really work in the affected versions of XDarwin.
So when you see messages like these, scroll up in the Terminal
resp. Console window and look for another set of banner and messages.
This affects all versions up to and including XDarwin 1.0a3; it was
fixed after 1.0a3 was released.
</p>
      <codeblock>cat: /Users/chrisp/.Xauthority: No such file or directory</codeblock>
      <p>
Class: Mostly harmless.
It is unknown where these messages come from and they seem to have no
impact on operations.
You can get rid of them by running <code>touch .Xauthority</code> in
your home directory.
</p>
      <codeblock>Gdk-WARNING **: locale not supported by C library</codeblock>
      <p>
Class: Harmless.
This just means what it says and won't keep the application from
working.
For more information, <xref section="locale" >see below</xref>.
</p>
      <codeblock>Gdk-WARNING **: locale not supported by Xlib, locale set to C
Gdk-WARNING **: can not set locale modifiers</codeblock>
      <p>
Class: Bad, but not fatal.
These messages may appear in addition to the one above.
This indicates that XFree86's locale data files are not present.
It appears that this happens unreproducibly when building Free86 from
source.
Most applications will still work, GNU Emacs is a notable exception.
</p>
      <codeblock>Unable to open keymapping file USA.keymapping.
Reverting to kernel keymapping.</codeblock>
      <p>
Class: Often fatal.
This can happen with XDarwin 1.0a1, with the &quot;Load from file&quot;
keymapping option enabled.
That version needs a full path when the file to load is set via the
Preferences dialog, but searches automatically when it is passed on
the command line.
The message will usually be followed by the &quot;assert&quot; message shown
below.
To fix this, follow the directions below.
</p>
      <codeblock>Fatal server error:
assert failed on line 454 of darwinKeyboard.c!</codeblock>
      <codeblock>Fatal server error:
Could not get kernel keymapping! Load keymapping from file instead.</codeblock>
      <p>
Class: Fatal.
Changes Apple made in Mac OS X 10.1 broke the code in XFree86 that
reads the keyboard layout from the operating system kernel;
the message above is the result of that.
You must use the &quot;Load from file&quot; keymapping option on Mac OS X 10.1.
The setting is in the XDarwin Preferences dialog.
Be sure that a file is selected (i.e. use the &quot;Pick file&quot; button) -
simply activating the check box may not be sufficient with some
versions of XDarwin.
If you can't get to the Preferences dialog because XDarwin closes
before you get a chance, run it from Terminal with the command
<code>startx -- -quartz -keymap USA.keymapping</code>.
This usually allows XDarwin to start up, and you can then make the
permanent choice in the Preferences dialog.
</p>
      <codeblock>Fatal server error:
Could not find keymapping file .</codeblock>
      <p>Class: Fatal (as it says).  This error is due to the absence of the keymapping files under Panther.  You need to install <code>xfree86-4.3.99-16</code> or later, since these versions don't need the keymapping files.</p>
      <codeblock>Warning: no access to tty (Inappropriate ioctl for device).
Thus no job control in this shell.</codeblock>
      <p>
Class: Mostly harmless.
XDarwin 1.0a2 and later launch an interactive shell behind the scenes
to run your client startup file (.xinitrc).
This was done so that you don't have to add statements to set up PATH
in that file.
Some shells complain that they're not connected to a real terminal,
but that can be ignored since that shell instance is not used for
anything that requires job control or the like.
</p>
      <codeblock>Fatal server error:
failed to connect as window server!</codeblock>
      <p>
Class: Fatal.
This means that the console-mode server (for pure Darwin) got started
while you were logged into Aqua.
Usually this happens when you installed the official XFree86 binary
distribution and left out the Xquartz.tgz tarball.
It can also happen when the symlinks in /usr/X11R6/bin are messed up
or when you issue the command <code>XDarwin</code> in a Terminal
window to start the server (you should use startx instead in that
case, see <xref chapter="run-xfree86" >Starting XFree86</xref>).
</p>
      <p>
In any case, you can run <code>ls -l /usr/X11R6/bin/X*</code> and
check the output.
You should see four relevant entries:
<code>X</code>, a symlink pointing at <code>XDarwinStartup</code>;
<code>XDarwin</code>, an executable file (this is the console
mode server);
<code>XDarwinQuartz</code>, a symlink pointing at
<filename>/Applications/XDarwin.app/Contents/MacOS/XDarwin</filename>;
and <code>XDarwinStartup</code>, a small executable file.
If any of these are missing or pointing at different files, you need
to fix that.
How you do that depends on the method you used to install XFree86.
See the <xref section="rootless" chapter="inst-xfree86" >Roaming
Rootless Servers</xref> section for more hints.
</p>
      <codeblock>The XKEYBOARD keymap compiler (xkbcomp) reports:
> Error:            Can't find file &quot;unknown&quot; for geometry include
>                   Exiting
>                   Abandoning geometry file &quot;(null)&quot;
Errors from xkbcomp are not fatal to the X server</codeblock>
      <p>
Class: Mostly harmless.
As the message says, it is not fatal.
To my knowledge, XDarwin doesn't use the XKB extension at all.
Probably some client program tries to use it anyway...
</p>
      <codeblock>startx: Command not found.</codeblock>
      <p>
Class: Fatal.
This can happen with XDarwin 1.0a2 and 1.0a3 when your shell
initialization files are not set up to add /usr/X11R6/bin to the PATH
variable.
If you use Fink and haven't changed your default shell, adding the
line <code>source /sw/bin/init.csh</code> to <filename>.cshrc</filename>
in your home directory (as recommended by the Fink instructions) should
be sufficient.
</p>
      <codeblock>_XSERVTransSocketUNIXCreateListener: ...SocketCreateListener() failed
_XSERVTransMakeAllCOTSServerListeners: server already running</codeblock>
      <codeblock>Fatal server error:
Cannot establish any listening sockets - Make sure an X server isn't already
running</codeblock>
      <p>
Class: Fatal.
This can happen when you accidentally run several instances of XDarwin
at once,
or maybe after an unclean shutdown (i.e. crash) of XDarwin.
It might also be a file permission problem with the sockets for local
connections.
You can try to clean that up with <code>rm -rf /tmp/.X11-unix</code>.
Restarting the computer also helps in most cases (Mac OS X
automatically cleans up /tmp when it boots, and the network stack is
reset).
</p>
      <codeblock>Xlib: connection to &quot;:0.0&quot; refused by server
Xlib: Client is not authorized to connect to Server</codeblock>
      <p>
Class: Fatal.
The client programs can't connect to the display server (XDarwin)
because they use bogus authentication data.
This can be caused by some VNC installations,
by running XDarwin through sudo,
and probably some other freak accidents.
The usual fix is to delete the .Xauthority file (which stores the
authentication data) in your home directory and re-create an empty
file:
</p>
      <codeblock>cd
rm .Xauthority
touch .Xauthority</codeblock>
<!--
<codeblock>more error messages still to come...</codeblock>
-->      <p>
Another common cause for XFree86 startup failures is an incorrect
<filename>.xinitrc</filename> file.
What happens is that the <filename>.xinitrc</filename> is run and for some
reason terminates almost immediately.
<code>xinit</code> interprets this as &quot;the user's session has ended&quot;
and kills XDarwin.
See the <xref section="xinitrc" chapter="run-xfree86" >.xinitrc
section</xref> for more details.
Remember to set up the PATH and to have one long-lived program that is
not started in the background.
It is a good idea to add <code>exec xterm</code> as a fallback when
your window manager or similar can't be found.
</p>
<!--
<p>
Some common problems that lead to this:
</p>
<ul>

<li><p>
All apps are started in the background.
Instead the last one must be started if the foreground (no
<code>&amp;</code> at the end of the line), or better with
<code>exec</code>.
</p></li>

<li><p>
The app that should run in the foreground can't be found.
This can happen when you give just the name without the path
(e.g. <code>xterm</code>), but forget to set the shell's search path
(environment variable PATH).
Neither /usr/X11R6/bin nor /sw/bin are in the default path.
If you use Fink, just add an <code>source /sw/bin/init.sh</code> to
the start of the <code>.xinitrc</code>.
To set the path manually, use this piece:
</p>
<codeblock>PATH=$PATH:/usr/X11R6/bin
export PATH</codeblock>
</li>

<li><p>
The app that should run in the foreground doesn't start or quits
immediately for some other reason.
There are many possibilities here, like missing libraries or missing
configuration files.
WindowMaker for instance requires that you run
<code>wmaker.inst</code> once before using it.
A good troubleshooting tactic in this situation is to replace the
forground app with <code>xterm</code> and launch it manually from the
xterm that comes up.
This way you can see diagnostic messages.
</p></li>

</ul>
<p>
Of course, there's always the last reason: a bug in XDarwin.
But most of the time, it really boils down to one of the above, even
when XDarwin crashes after some seconds.
</p>
-->    </section>
    <section name="black" >
      <title>Black icons in the GNOME panel or in the
menu of a GNOME application</title>
      <p>
A common problem is that icons or other images are displayed as black
rectangles or black outlines.
Ultimately, this is caused by limitations in the operating system
kernel.
The problem has been reported to Apple, but so far they seem unwilling
to fix it; see the filed <link url="http://www.opensource.apple.com/bugs/X/Kernel/2691632.html" >Darwin
bug report</link> for details.
</p>
      <p>
The current situation is that the MIT-SHM extension of the X11
protocol is practically unusable on Darwin and Mac OS X.
There are two ways to turn the protocol extension off: in the server
or in the clients.
The XFree86 servers installed by Fink (i.e. the xfree86-server and
xfree86-rootless packages) have it turned off.
The GIMP and the GNOME panel have been inoculated as well.
If you experience black icons in another application, start that
application with the <code>--no-xshm</code> command line option.
</p>
    </section>
    <section name="keyboard" >
      <title>The keyboard doesn't work in XFree86</title>
      <p>
This is a known problem that so far seems to affect only portables
(PowerBook, iBook).
To work around this, the &quot;Load from file&quot; keymapping option was
implemented.
Nowadays it has become the default because the old method (reading the
mapping from the kernel) stopped working with Mac OS X 10.1.
If you haven't enabled the option already, you can do so in the
XDarwin preferences dialog.
Check the &quot;Load from file&quot; checkbox and select the keymapping file to
load.
After restarting XDarwin, your keyboard should mostly work (see
below).
</p>
      <p>
If you're starting XFree86 from the command line, you can pass the
name of the keymapping file to load as an option, as in:
</p>
      <codeblock>startx -- -quartz -keymap USA.keymapping</codeblock>
    </section>
    <section name="delete-key" >
      <title>The Backspace key doesn't work</title>
      <p>
This can happen when you use the &quot;Load keymapping from file&quot; option
described above.
The mapping files describe the backspace key as &quot;Delete&quot;, not as
&quot;Backspace&quot;.
You can correct that by putting the following line in your .xinitrc
file:
</p>
      <codeblock>xmodmap -e &quot;keycode 59 = BackSpace&quot;</codeblock>
      <p>
If I remember correctly, XDarwin 1.0a2 and later have code that
correctly maps the Backspace key automatically.
</p>
    </section>
    <section name="locale" >
      <title>&quot;Warning: locale not supported by C library&quot;</title>
      <p>
These messages are quite common, but harmless.
It just means what it says - internationalization is not supported
through the standard C library, the program will use the default
English messages, date formats, and so on.
There are several ways to deal with this:
</p>
      <ul>
        <li>
          <p>
Just ignore the messages.
</p>
        </li>
        <li>
          <p>
Get rid of the messages by unsetting the environment variable LANG.
Note that this will also turn internationalization off in programs
that actually support it (via gettext/libintl).
Example for .xinitrc:
</p>
          <codeblock>unset LANG</codeblock>
          <p>
Example for .cshrc:
</p>
          <codeblock>unsetenv LANG</codeblock>
        </li>
        <li>
          <p>
(10.1 only) Use the <code>libxpg4</code> Fink package.
It builds a small library that contains working locale functions and
arranges that it is loaded before the system libraries (using the
DYLD_INSERT_LIBRARIES environment variable).
You may have to set the LANG environment variable to a fully qualified
value, e.g. <code>de_DE.ISO_8859-1</code> instead of <code>de</code>
or <code>de_DE</code>.
</p>
        </li>
        <li>
          <p>
Ask Apple to include proper locale support in a future version of Mac
OS X.
</p>
        </li>
      </ul>
    </section>
  </chapter>
  <chapter filename="tips" >
    <title>Usage Tips</title>
    <shorttitle>Tips</shorttitle>
    <section name="terminal-app" >
      <title>Launching X11 apps from Terminal.app</title>
      <p>
To launch X11 applications from a Terminal.app window, you must set
the environment variable &quot;DISPLAY&quot;.
This variable tells the applications where to find the X11 window
server.
In the default setup - XDarwin runs on the same machine, your shell is
tcsh - you can set the variable as follows:
</p>
      <codeblock>setenv DISPLAY :0.0</codeblock>
      <p>
A nice setup is to have XDarwin.app started when you log in (settable
in the Login panel of the System Preferences) and add the following to
your .cshrc:
</p>
      <codeblock>if (! $?DISPLAY) then
  setenv DISPLAY :0.0
endif</codeblock>
      <p>
This sets DISPLAY automatically in every shell.
It doesn't override the current value when DISPLAY is already set,
though.
This way you can still run X11 applications remotely or through ssh
with X11 tunneling.
</p>
    </section>
    <section name="open" >
      <title>Launching Aqua apps from an xterm</title>
      <p>
One way to launch Aqua applications from an xterm (or any other shell,
actually) is the <code>open</code> command.
Some examples:
</p>
      <codeblock>open /Applications/TextEdit.app
open SomeDocument.rtf
open -a /Applications/TextEdit.app index.html</codeblock>
      <p>
The second example opens the document in the application that is
associated with it, the third example explicitly gives an application
to use.
</p>
    </section>
    <section name="copy-n-paste" >
      <title>Copy and Paste</title>
      <p>
Copy and Paste generally works between the Aqua and X11 environments.
There are still some bugs.
Emacs is reported to be picky about the current selection.
Copy and paste from Classic to X11 doesn't work.
</p>
      <p>
Anyway, the trick is to use the respective methods of the environment
you're in.
To transfer text from Aqua to X11, use Cmd-C in Aqua, then bring the
destination window to the front and use the &quot;middle mouse button&quot;, i.e. Option-click
on a single-button mouse (this can be configured 
under XDarwin's Preferences), to paste.
To transfer text from X11 to Aqua, simply select the text with the
mouse in X11, then use Cmd-V in Aqua to paste it.
</p>
      <p>
The X11 system actually has several separate clipboards (called &quot;cut
buffers&quot; in X11 speak), and some applications have weird views which
one should be used.
In particular, pasting into GNU Emacs or XEmacs sometimes doesn't work
because of this.
The program <code>autocutsel</code> can help here; it automatically
synchronizes the two main cut buffers.
To run it, install the autocutsel Fink package and add the following
line to your .xinitrc:
</p>
      <codeblock>autocutsel &amp;</codeblock>
      <p>
(Make sure it's <em>before</em> the line that exec's the window
manager and never returns! Don't just add it at the end, it won't
be executed.)
</p>
      <p>If you are using Apple's X11, then you can use Command-C or Edit->Copy, as 
usual for Mac apps, to copy text to the clipboard.  However, pasting 
from the clipboard to Apple X11 via Command-V doesn't work yet.</p>
    </section>
  </chapter>
</document>
